[
    {
        "title": "Contents",
        "content": "* 1 Introduction\n  * 2 Places history features\n  * 3 Example\n  * 4 Bookmark pages and notes\n  * 5 Required information\n  * 6 Database design\n  * 7 Performance\n    * 7.1 Link coloring\n    * 7.2 Database size"
    },
    {
        "title": "Introduction",
        "content": "The places history system is a redesign of the Firefox global history system\nusing the new SQLite-based mozStorage APIs. This system provides additional\nperformance, flexibility, and querying capabilities.\n\nSee also:\n\n  * [Places](/Places \"Places\")\n  * [Annotations](/Annotations \"Annotations\")\n  * [Firefox:2.0_Bookmarks](/Firefox:2.0_Bookmarks \"Firefox:2.0 Bookmarks\")"
    },
    {
        "title": "Places history features",
        "content": "The major places history views will be queries over places visited by time.\nThe user will be able to select any date range and see when they visited each\npage. Actually showing which pages were visited during a given time period\nmeans we will have to store every time the user visits any page, rather than\njust the last visit time. This fixes some problems with the old history system\nwhere items would move around if you visited them again.\n\nThese view should be as organized and as concise as possible. The old history\nsystem includes many redirect pages in the view, and doesn't have things like\nfavicons and good grouping that might make it easier to locate pages of\ninterest. As a result, favicons for every page will be stored for viewing in\nhistory, and we will provide better domain-style grouping and a calendar for\npicking days rather than a tree view.\n\nThe second most user-visible history feature will be keyword searching. This\nwill be essentially unchanged from the old system, which is too bad because\nthe current system sucks. Because there is no word index, we do a brute-force\nsearch over all titles for the keyword in question. While sometimes useful,\nthis is not always what you want, resulting in a number of third-party history\nindexing products. Long term, it would be nice to index pages you visit. For\nthe coming release it might be nice to provide a hook for third-party products\nso they can provide text searching capabilities to the places system.\n\nThe last major change will be the ability to define complex queries over the\nhistory and bookmark systems. Most users will not be generating such queries,\nbut they can be used to provide a variety of nice features. For example, a\nquery folder can be created for \"My favorite pages\" which contains the 20 most\nfrequently visited URLs in history. A query for the most frequently visited\npages that are not bookmarked provides a good candidate list for suggesting\nbookmarks."
    },
    {
        "title": "Example",
        "content": "This screenshot shows some of these ideas:\n\n[](/File:History_grouping.png)  \n_Image credit: Brett Wilson,<http://maxradi.us/>_\n\nAll pages have favicons for better visual differentiation and grouping. Pages\nare arranged into \"sessions\" consisting of followed links. Typing a new URL or\nfollowing a bookmark gives you a new \"session\" which appears as a dotted line\nin this image. This is an actual screenshot, but the ugly redirect pages have\nbeen manually removed. Proper tracking of redirect pages is pending, see\n[Browser_History:Redirects](/Browser_History:Redirects \"Browser\nHistory:Redirects\").\n\nAn informal goal is to save and expose enough information for a variety of\ninteresting visualization or suggestion extensions to be created. For example:\n\n  * A graph of the user's browsing behavior, showing which pages were visited and when and how the user navigated between them.\n  * Suggesting links. By looking at what link the user frequently visits from the current page, perhaps some sort of suggestion or prefetching could take place. For some pages, this indication would be very strong. Other AI-like things could potentially be done. For example, many people visit the same set of sites when they open the browser in the morning. It would be nice if something could be done to make this nicer."
    },
    {
        "title": "Bookmark pages and notes",
        "content": "Firefox 2 will likely have some kind of bookmark button for easy bookmarking\nof pages. This button will be illuminated whenever the user is on a bookmarked\npage, but redirects provide an extra problem. If the bookmark page is moved,\nor more commonly, if the user manually sets a bookmark, for example\n\"amazon.com\", they will be redirected. This destination page won't be\nbookmarked, so the button will not be illuminated. The old history system also\nhad problems with redirected bookmarks because the favicons would never get\nset properly. Therefore, we need to know more about redirects to handle these\ncases correctly.\n\nIf other annotations are stored with pages, redirects could also pose\nproblems. For example, if I have notes on a page and it is redirected, my\nnotes will not be available to me. There should be a way for services using\nannotation functionality to see if the current page was ever redirected from\nsomewhere else, and to also check those pages for annotations of interest.\nMore on redirects can be read on\n[Browser_History:Redirects](/Browser_History:Redirects \"Browser\nHistory:Redirects\")."
    },
    {
        "title": "Required information",
        "content": "It will be necessary to collect and store much more information than is done\nin the old history system. To extract information about sequences of page\nviews, we need to know exactly which page generated each navigation. Because\nthe same page could be opened in more than one tab/window at once, the URL is\nnot sufficient for this task."
    },
    {
        "title": "Database design",
        "content": "The history will be stored in two SQL tables â€” \"moz_history\" and\n\"moz_historyvisit\".\n\nThe \"history\" table essentially duplicates the functionality of the current\n[Mork](/Mork \"Mork\") history table: It contains:\n\n  * Unique ID (primary key)\n  * URL\n  * Title\n  * User-defined title\n  * Visit count\n  * Last visit date\n  * Host name (see below)\n  * Hidden (bool)\n  * Typed (bool)\n\nNote that the host name is stored backwards, unlike the current table. This is\ndone so that it can be indexed alphabetically and we can quickly pull out all\npages within any \"mozilla.org\" domain by asking for hostname fields that begin\nwith \"gro.allizom.\" A period is always appended to the reversed hostname.\n\nThe second table stores transitions between pages, which is information\nunavailable now.\n\n  * Source *visit* ID\n  * Destination page ID\n  * Time\n  * Transition type\n\nTransition type will hopefully contain info about whether the link was a\nredirect clicked, opened in new tab/window, typed, just an image on the page,\netc.\n\nBecause the source for each visit is another visit, not just a URL, we can\ntrack transitions between specific viewings of pages."
    },
    {
        "title": "Performance",
        "content": "The SQLite database system does file-level locking to manage access to the\ndatabase. This means that for every transaction (even read), the database file\nmust be checked for changes to update the cache, and locked. Most systems can\ndo this quickly, although this operation is clearly not good for performance.\nSome Linux/Unix users may have their home directories and profiles stored on a\nnetwork-mounted drive. In these cases, individual database accesses can be\nrelatively expensive.\n\nTherefore, it is very important that database access be minimized and grouped\nin transactions. A new query/result format will be used instead of RDF. RDF\nrequires many extra transactions, to retrieve the ID of a URL, then to\nretrieve the title, then to retrieve the visit date, etc. This makes\nperformance, especially for network users, unacceptably slow. The new query\nsystem will retrieve one set of results for one query, meaning that there will\nbe only one database access or the accesses can be internally grouped in a\ntransaction. Initial tests of this system show that is is plenty fast enough\nover a good network and virtually instant for local users (the majority).\n\n### Link coloring\n\nLink coloring is perhaps the most important performance issue, since this\ndirectly affects page load time. A naive approach requires querying the\ndatabase for each link that comes in. Even when the history database is local,\nasking the OS for a file lock for each link on a page will be very bad for\nperformance.\n\nTo solve this problem, URLs will be loaded into an in-memory database when the\napplication starts (or, perhaps, the first time they are required). These\nlinks can be sorted so they can be accessed very quickly, and require no OS\ncalls or file locks. This list will only contain URLs, and none of the extra\ninformation such as visit dates, visit counts, and titles.\n\nBecause these data will reside in memory, it is important to not take too much\nspace. If we succeed in the goal of allowing users to keep large amounts of\nhistory, size could be significant. We will, therefore, want to limit the\nnumber of URLs that we bring into memory, either allowing, for example, the\npast 10,000 URLs, or the past 30 days of visits.\n\nA two-level approach may improve perceived size. Most URLs in the table are\nadvertisements and random images from Web sites to which the user will never\nsee a link, and probably wouldn't even care about if they did. Then there are\nthe top-level pages (with hidden=false) that are the top-level URLs that the\nuser actually visited. They are much more likely to care about these top-level\nlinks. To save space and speed things up, we could keep the past X URLs in\nmemory, plus the previous Y top-level URLs. It is unlikely that users will\neven notice that most of their history links are not being used for link\ncoloring.\n\n### Database size\n\nI just imported my [Mork](/Mork \"Mork\") history database file into the\nequivalent SQLite format. The SQLite file size was one-tenth of the original\nMork file. So, even though we will be storing more information (every time a\npage is visited) overall database size will probably be smaller.\n\nRetrieved from\n\"[https://wiki.mozilla.org/index.php?title=Browser_History&oldid=976107](https://wiki.mozilla.org/index.php?title=Browser_History&oldid=976107)\""
    },
    {
        "title": "Navigation menu",
        "content": "###  Personal tools\n\n  * [Log in](/index.php?title=Special:UserLogin&returnto=Browser+History \"You are encouraged to log in; however, it is not mandatory \\[o\\]\")\n  * [Request account](/Special:RequestAccount \"You are encouraged to create an account and log in; however, it is not mandatory\")\n\n###  Namespaces\n\n  * [Page](/Browser_History \"View the content page \\[c\\]\")\n  * [Discussion](/Talk:Browser_History \"Discussion about the content page \\[t\\]\")\n\nEnglish\n\n###  Views\n\n  * [Read](/Browser_History)\n  * [View source](/index.php?title=Browser_History&action=edit \"This page is protected.\nYou can view its source \\[e\\]\")\n\n  * [View history](/index.php?title=Browser_History&action=history \"Past revisions of this page \\[h\\]\")\n\nMore\n\n###  Search\n\n[](/Main_Page \"Visit the main page\")\n\n###  Navigation\n\n  * [Main page](/Main_Page \"Visit the main page \\[z\\]\")\n  * [Product releases](/Releases)\n  * [New pages](/Special:NewPages)\n  * [Recent changes](/Special:RecentChanges \"A list of recent changes in the wiki \\[r\\]\")\n  * [Recent uploads](/Special:NewFiles)\n  * [Help](/MozillaWiki:Help \"The place to find out\")\n\n###  How to Contribute\n\n  * [Contribute to Mozilla](/Contribute)\n  * [Community Portal](//community.mozilla.org)\n  * [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)\n\n###  MozillaWiki\n\n  * [About](/MozillaWiki:About)\n  * [Team](/MozillaWiki:Team)\n  * [Policies](/MozillaWiki:Policies)\n  * [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)\n\n###  Around Mozilla\n\n  * [Mozilla Support](//support.mozilla.org/)\n  * [Give product Feedback](//connect.mozilla.org/)\n  * [Mozilla Developer Network](//developer.mozilla.org/)\n  * [Planet Mozilla](//planet.mozilla.org/)\n\n###  Tools\n\n  * [What links here](/Special:WhatLinksHere/Browser_History \"A list of all wiki pages that link here \\[j\\]\")\n  * [Related changes](/Special:RecentChangesLinked/Browser_History \"Recent changes in pages linked from this page \\[k\\]\")\n  * [Special pages](/Special:SpecialPages \"A list of all special pages \\[q\\]\")\n  * [Printable version](javascript:print\\(\\); \"Printable version of this page \\[p\\]\")\n  * [Permanent link](/index.php?title=Browser_History&oldid=976107 \"Permanent link to this revision of this page\")\n  * [Page information](/index.php?title=Browser_History&action=info \"More information about this page\")\n\n  * This page was last edited on 12 May 2014, at 22:33.\n\n  * [Privacy policy](/MozillaWiki:Privacy_policy)\n  * [About MozillaWiki](/MozillaWiki:About)\n  * [Mobile view](https://wiki.mozilla.org/index.php?title=Browser_History&mobileaction=toggle_view_mobile)\n\n  * [](https://www.mediawiki.org/)"
    }
]